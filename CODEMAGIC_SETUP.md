# Codemagic CI/CD Setup Guide

## Overview
Codemagic is a CI/CD platform specifically designed for mobile app development. This guide will help you set up automated builds, testing, and deployment for your Flutter app.

## Prerequisites
- A GitHub, GitLab, or Bitbucket repository
- Codemagic account (free tier available)

## Setup Steps

### 1. Create Codemagic Account
1. Go to [codemagic.io](https://codemagic.io)
2. Sign up with your Git provider (GitHub, GitLab, or Bitbucket)
3. Connect your repository

### 2. Configure Your Project
1. In Codemagic dashboard, click "Add application"
2. Select your repository
3. Choose "Flutter" as the project type
4. Codemagic will automatically detect the `codemagic.yaml` file

### 3. Environment Variables Setup

#### For iOS (App Store Connect):
You'll need to add these environment variables in Codemagic:
- `APP_STORE_CONNECT_PRIVATE_KEY`: Your App Store Connect API key
- `APP_STORE_CONNECT_KEY_IDENTIFIER`: Your App Store Connect key ID
- `APP_STORE_CONNECT_ISSUER_ID`: Your App Store Connect issuer ID

#### For Android (Google Play):
You'll need to add these environment variables in Codemagic:
- `CM_KEYSTORE_PATH`: Base64 encoded keystore file
- `CM_KEYSTORE_PASSWORD`: Keystore password
- `CM_KEY_ALIAS`: Key alias
- `CM_KEY_PASSWORD`: Key password

### 4. Generate Android Keystore
If you don't have a keystore for Android signing:

```bash
keytool -genkey -v -keystore ~/upload-keystore.jks -keyalg RSA -keysize 2048 -validity 10000 -alias upload
```

Then encode it for Codemagic:
```bash
base64 ~/upload-keystore.jks | tr -d '\n' | tee ~/upload-keystore.jks.base64.txt
```

### 5. Configure Android Signing
Create `android/key.properties` file (this will be generated by Codemagic):
```properties
storeFile=/tmp/keystore.keystore
storePassword=your_keystore_password
keyAlias=upload
keyPassword=your_key_password
```

### 6. Available Workflows

#### iOS Workflow
- Builds iOS app for App Store
- Includes code signing setup
- Publishes to TestFlight

#### Android Workflow
- Builds both APK and App Bundle
- Includes keystore setup
- Publishes to Google Play Console

#### Test Workflow
- Runs Flutter tests
- Generates test coverage reports

#### Build Workflow
- Runs Flutter analyze
- Builds web version
- Good for validation

### 7. Triggering Builds
- **Automatic**: On every push to main branch
- **Manual**: From Codemagic dashboard
- **Pull Request**: On PR creation/update

### 8. Build Artifacts
Each workflow generates:
- Built app files (.ipa, .apk, .aab)
- Build logs
- Test reports (if applicable)

## Troubleshooting

### Common Issues

1. **Code Signing Errors (iOS)**
   - Ensure App Store Connect API keys are correct
   - Check bundle identifier matches your app

2. **Keystore Errors (Android)**
   - Verify keystore is properly base64 encoded
   - Check passwords and aliases match

3. **Build Failures**
   - Check Flutter version compatibility
   - Ensure all dependencies are properly specified

### Getting Help
- [Codemagic Documentation](https://docs.codemagic.io/)
- [Codemagic Community](https://codemagic.io/community/)
- [Flutter CI/CD Guide](https://docs.codemagic.io/flutter/flutter-projects/)

## Next Steps
1. Set up your first build
2. Configure automatic deployments
3. Set up notifications for build status
4. Configure branch-specific workflows if needed
